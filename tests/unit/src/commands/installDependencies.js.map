{"version":3,"file":"installDependencies.js","sourceRoot":"","sources":["../../../../../tests/unit/src/commands/installDependencies.ts"],"names":[],"mappings":";;;;;;;;;;;;IAAA,2DAA8E;IAC9E,+BAAwC;IAEhC,IAAA,2DAAa,CAAmC;IAChD,IAAA,wCAAM,CAA8B;IAE5C,IAAI,mBAAwB,CAAC;IAC7B,IAAI,QAAmB,CAAC;IACxB,IAAI,eAA0B,CAAC;IAC/B,IAAI,cAAyB,CAAC;IAE9B,aAAa,CAAC,8BAA8B,EAAE;QAC7C,MAAM;YACL,QAAQ,GAAG,YAAI,EAAE,CAAC;YAClB,eAAe,GAAG,YAAI,EAAE,CAAC;YACzB,cAAc,GAAG,YAAI,EAAE,CAAC;QACzB,CAAC;QAED,KAAK;YACJ,+BAAkB,EAAE,CAAC;QACtB,CAAC;QAED,UAAU;YACT,mBAAmB,GAAG,oBAAU,CAAC,OAAO,EAAE,8CAA8C,EAAE;gBACzF,MAAM,EAAE;oBACP,IAAI,EAAE,QAAQ;iBACd;gBACD,iBAAiB,EAAE;oBAClB,WAAW,EAAE,eAAe;iBAC5B;gBACD,IAAI,EAAE;oBACL,UAAU,EAAE,cAAc;iBAC1B;aACD,CAAC,CAAC;QACJ,CAAC;QAED,SAAS;YACR,QAAQ,CAAC,KAAK,EAAE,CAAC;YACjB,eAAe,CAAC,KAAK,EAAE,CAAC;YACxB,cAAc,CAAC,KAAK,EAAE,CAAC;QACxB,CAAC;QAED,KAAK,EAAE;YACP,mBAAmB,EAAE,CAAC;gBACrB,IAAM,GAAG,GAAG,KAAK,CAAC;gBAClB,IAAM,cAAc,GAAG,kBAAkB,CAAC;gBAE1C,MAAM,CAAC;oBACA,qBAAqB;;;;;wCAC1B,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;wCAE7B,WAAM,yBAAyB,CAAC,GAAG,CAAC,EAAA;;wCAApC,SAAoC,CAAC;wCAErC,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;wCAC3C,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;;;;;qBAChE;oBAEK,6BAA6B;;;;;wCAClC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;wCAE9B,WAAM,yBAAyB,CAAC,GAAG,CAAC,EAAA;;wCAApC,SAAoC,CAAC;wCAErC,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;;;;;qBAC1C;iBACD,CAAC;gBAEF,mCAAyC,GAAW;;;;;;oCACnD,QAAQ,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;oCAEb,WAAM,mBAAmB,CAAC,GAAG,CAAC,EAAA;;oCAA5C,WAAW,GAAG,SAA8B;oCAElD,MAAM,CAAC,WAAW,CAAC,WAAW,EAAE,cAAc,CAAC,CAAC;oCAChD,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;oCACnC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;oCACpD,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;oCAE/D,WAAO,WAAW,EAAC;;;;iBACnB;YACF,CAAC,CAAC,EAAE;SACH;KACD,CAAC,CAAC","sourcesContent":["import loadModule, { cleanupModuleMocks } from '../../../_support/loadModule';\nimport { stub, SinonStub } from 'sinon';\n\nconst { registerSuite } = intern.getInterface('object');\nconst { assert } = intern.getPlugin('chai');\n\nlet installDependencies: any;\nlet joinStub: SinonStub;\nlet promiseExecStub: SinonStub;\nlet existsSyncStub: SinonStub;\n\nregisterSuite('commands/installDependencies', {\n\tbefore() {\n\t\tjoinStub = stub();\n\t\tpromiseExecStub = stub();\n\t\texistsSyncStub = stub();\n\t},\n\n\tafter() {\n\t\tcleanupModuleMocks();\n\t},\n\n\tbeforeEach() {\n\t\tinstallDependencies = loadModule(require, '../../../../src/commands/installDependencies', {\n\t\t\t'path': {\n\t\t\t\tjoin: joinStub\n\t\t\t},\n\t\t\t'../util/process': {\n\t\t\t\tpromiseExec: promiseExecStub\n\t\t\t},\n\t\t\t'fs': {\n\t\t\t\texistsSync: existsSyncStub\n\t\t\t}\n\t\t});\n\t},\n\n\tafterEach() {\n\t\tjoinStub.reset();\n\t\tpromiseExecStub.reset();\n\t\texistsSyncStub.reset();\n\t},\n\n\ttests: {\n\tinstallDependencies: (() => {\n\t\tconst dir = 'dir';\n\t\tconst typingsJsonDir = 'dir/typings.json';\n\n\t\treturn {\n\t\t\tasync 'typings.json exists'() {\n\t\t\t\texistsSyncStub.returns(true);\n\n\t\t\t\tawait assertInstallDependencies(dir);\n\n\t\t\t\tassert.isTrue(promiseExecStub.calledTwice);\n\t\t\t\tassert.strictEqual(promiseExecStub.secondCall.args[1].cwd, dir);\n\t\t\t},\n\n\t\t\tasync 'typings.json does not exist'() {\n\t\t\t\texistsSyncStub.returns(false);\n\n\t\t\t\tawait assertInstallDependencies(dir);\n\n\t\t\t\tassert.isTrue(promiseExecStub.calledOnce);\n\t\t\t}\n\t\t};\n\n\t\tasync function assertInstallDependencies(dir: string) {\n\t\t\tjoinStub.returns(typingsJsonDir);\n\n\t\t\tconst typingsJson = await installDependencies(dir);\n\n\t\t\tassert.strictEqual(typingsJson, typingsJsonDir);\n\t\t\tassert.isTrue(joinStub.calledOnce);\n\t\t\tassert.strictEqual(joinStub.firstCall.args[0], dir);\n\t\t\tassert.strictEqual(promiseExecStub.firstCall.args[1].cwd, dir);\n\n\t\t\treturn typingsJson;\n\t\t}\n\t})()\n\t}\n});\n"]}