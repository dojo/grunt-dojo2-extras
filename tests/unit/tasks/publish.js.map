{"version":3,"file":"publish.js","sourceRoot":"","sources":["../../../../tests/unit/tasks/publish.ts"],"names":[],"mappings":"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","sourcesContent":["import * as grunt from 'grunt';\nimport { stub, spy, SinonStub } from 'sinon';\nimport loadModule, { cleanupModuleMocks } from '../../_support/loadModule';\nimport { setupWrappedAsyncStub } from '../../_support/tasks';\n\nconst { registerSuite } = intern.getInterface('object');\nconst { assert } = intern.getPlugin('chai');\n\nlet publish: any;\nlet gruntOptionStub: SinonStub;\n\nconst Git = class {\n\tconstructor() {}\n};\nconst GitSpy = spy(Git);\nconst publishStub = stub();\nconst hasGitCredentialsStub = stub();\nconst publishModeStub = stub();\nconst wrapAsyncTaskStub = stub();\nconst optionsStub = stub();\n\nregisterSuite('tasks/publish', {\n\tbefore() {\n\t\tpublish = loadModule(require, '../../../tasks/publish', {\n\t\t\t'../src/commands/publish': { default: publishStub.returns(Promise.resolve()) },\n\t\t\t'../src/util/Git': { default: GitSpy },\n\t\t\t'./util/wrapAsyncTask': { default: wrapAsyncTaskStub },\n\t\t\t'../src/util/environment': {\n\t\t\t\thasGitCredentials: hasGitCredentialsStub,\n\t\t\t\tpublishMode: publishModeStub\n\t\t\t}\n\t\t});\n\t},\n\n\tafter() {\n\t\tcleanupModuleMocks();\n\t},\n\n\tbeforeEach() {\n\t\tgruntOptionStub = stub(grunt, 'option');\n\t\toptionsStub.yieldsTo('publishMode').returns({\n\t\t\tcloneDirectory: 'cloneDirectory',\n\t\t\tpublishMode: null,\n\t\t\trepo: null\n\t\t});\n\n\t},\n\n\tafterEach() {\n\t\tpublishStub.reset();\n\t\thasGitCredentialsStub.reset();\n\t\tpublishModeStub.reset();\n\t\tGitSpy.reset();\n\t\twrapAsyncTaskStub.reset();\n\t\toptionsStub.reset();\n\n\t\tgruntOptionStub.restore();\n\t},\n\n\ttests: {\n\t'publish task runs, has git credentials; eventually resolves'(this: any) {\n\t\tgruntOptionStub.returns('publishMode');\n\t\thasGitCredentialsStub.returns(true);\n\n\t\tsetupWrappedAsyncStub.call({\n\t\t\toptions: optionsStub\n\t\t}, wrapAsyncTaskStub, this.async(), () => {\n\t\t\tassert.isTrue(hasGitCredentialsStub.calledOnce, 'Should always check for git credentials');\n\t\t\tassert.isTrue(GitSpy.calledOnce, 'Should always create a git utility');\n\t\t\tassert.isTrue(publishStub.calledOnce, 'Should always call publish');\n\n\t\t\tassert.isTrue(publishModeStub.calledOnce, 'Should call publishMode when there are git credentials');\n\t\t});\n\n\t\tpublish(grunt);\n\n\t\tassert.isTrue(wrapAsyncTaskStub.calledOnce);\n\t},\n\n\t'publish task runs, has no git credentials; eventually resolves'(this: any) {\n\t\tsetupWrappedAsyncStub.call({\n\t\t\toptions: optionsStub\n\t\t}, wrapAsyncTaskStub, this.async(), () => {\n\t\t\tassert.isTrue(hasGitCredentialsStub.calledOnce, 'Should always check for git credentials');\n\t\t\tassert.isTrue(GitSpy.calledOnce, 'Should always create a git utility');\n\t\t\tassert.isTrue(publishStub.calledOnce, 'Should always call publish');\n\n\t\t\tassert.isTrue(publishModeStub.notCalled, 'Shouldn\\'t call publish mode when there are no git credentials');\n\t\t});\n\n\t\tpublish(grunt);\n\n\t\tassert.isTrue(wrapAsyncTaskStub.calledOnce);\n\t}\n\t}\n});\n"]}